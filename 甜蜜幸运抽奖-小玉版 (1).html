<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="color-scheme" content="light only" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="format-detection" content="telephone=no, email=no, address=no" />
  <title>甜蜜幸运抽奖 · 给亲爱的的小玉</title>

  <!-- Performance: font preconnect -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&family=Nunito:wght@400..900&display=swap" rel="stylesheet">

  <style>
    /* ---------- 基础与变量 ---------- */
    :root {
      --pink-50:#fff5f9;
      --pink-100:#ffe9f3;
      --pink-200:#ffd6e7;
      --pink-300:#ffb7d2;
      --pink-400:#ff99c1;
      --pink-500:#ff73ab;
      --pink-600:#ff5fa2;
      --pink-700:#ff3d8d;
      --rose-600:#ff2f7d;
      --shadow: 0 10px 30px rgba(255, 95, 162, .28);
      --ring: 0 0 0 3px rgba(255, 143, 177, .35);
      --radius-2: 16px;
      --radius-3: 24px;
      --radius-4: 32px;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    html {
      -webkit-text-size-adjust: 100%;
    }
    body {
      margin: 0;
      font-family: 'Nunito', system-ui, -apple-system, Segoe UI, Roboto, 'PingFang SC','Microsoft YaHei', sans-serif;
      line-height: 1.6;
      color: #463a3e;
      background:
        radial-gradient(1200px 800px at 70% -10%, #ffe9f2 0%, var(--pink-50) 45%, #fff 100%);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
    }

    /* iOS 安全区适配 */
    .safe {
      padding: max(16px, env(safe-area-inset-top)) max(16px, env(safe-area-inset-right)) max(16px, env(safe-area-inset-bottom)) max(16px, env(safe-area-inset-left));
    }

    /* 漂浮元素（可爱） */
    .floaters { position: fixed; inset: 0; pointer-events: none; z-index: 0; }
    .floater { position: absolute; opacity: .22; filter: drop-shadow(0 2px 2px rgba(255,95,162,.25)); will-change: transform; animation: float linear infinite; }
    @keyframes float {
      from { transform: translateY(100vh) rotate(0); }
      to   { transform: translateY(-10vh) rotate(360deg); }
    }
    .heart::before { content: "❤"; font-size: 26px; color: var(--pink-600); }
    .star::before  { content: "✦"; font-size: 22px; color: #ffc6e0; }

    /* 布局卡片 */
    .wrap { position: relative; z-index: 1; min-height: 100vh; display: grid; place-items: center; }
    .card {
      width: min(820px, 92vw);
      background: linear-gradient(180deg, #fff, var(--pink-100));
      border-radius: var(--radius-4);
      box-shadow:
        0 1px 0 #fff inset,
        0 0 0 1px #ffe2ef,
        0 20px 50px rgba(255,95,162,.25);
      padding: clamp(20px, 5vw, 36px);
    }

    .title {
      font-family: 'ZCOOL KuaiLe','Nunito',sans-serif;
      text-align: center;
      font-size: clamp(24px, 5vw, 38px);
      color: var(--rose-600);
      letter-spacing: .5px;
      margin: 6px 0 10px;
      text-shadow: 0 1px 0 #fff, 0 6px 20px rgba(255,47,125,.15);
    }
    .subtitle {
      text-align: center; color: #7a6870; margin: 0 0 16px; font-size: 14px;
    }

    /* 按钮（3D） */
    .btn {
      appearance: none; -webkit-tap-highlight-color: transparent;
      user-select: none; border: none; cursor: pointer;
      display: inline-flex; align-items: center; justify-content: center; gap: 8px;
      padding: 14px 22px; border-radius: 999px;
      font-weight: 900; letter-spacing: .3px;
      color: #fff; background: linear-gradient(135deg, var(--pink-600), var(--rose-600));
      box-shadow: 0 14px 24px rgba(255,95,162,.38), inset 0 -6px 10px rgba(0,0,0,.08);
      transform: translateZ(0);
      transition: transform .12s ease, box-shadow .12s ease, filter .12s ease;
      will-change: transform;
    }
    .btn:active { transform: translateY(1px); }
    .btn:focus-visible { outline: none; box-shadow: var(--ring), 0 14px 24px rgba(255,95,162,.45); }

    .muted {
      background: linear-gradient(180deg,#fff,#ffeaf3);
      color: var(--pink-700);
      border: 1px solid #ffd2e4;
      box-shadow: 0 10px 22px rgba(255,95,162,.22);
      font-weight: 800;
    }

    /* 入口区域 */
    .entry { display: grid; place-items: center; gap: 18px; }

    /* 抽奖区域 */
    .lotto { display: none; }
    .headline { font-size: 18px; text-align: center; margin: 6px 0 14px; }
    .headline b { color: var(--rose-600); }

    .wheel-wrap { display: grid; place-items: center; margin: 12px 0; }
    .glow {
      position: relative; width: 240px; height: 240px; border-radius: 50%;
      background: conic-gradient(from 0deg, #fff 0 20%, #ffd0e1 20% 40%, #fff 40% 60%, #ffd0e1 60% 80%, #fff 80% 100%);
      box-shadow: inset 0 0 0 10px #ffe6f1, var(--shadow);
      display: grid; place-items: center;
      animation: idle 3s ease-in-out infinite;
      will-change: transform;
    }
    @keyframes idle { 0%,100%{transform:scale(1)} 50%{transform:scale(1.02)} }

    .spin { animation: spin 1.2s cubic-bezier(.22,.61,.36,1) forwards; }
    @keyframes spin { to { transform: rotate(900deg); } }

    .draw-btn {
      position: relative; width: 160px; height: 160px; border-radius: 50%;
      font: inherit; color: #fff; background: radial-gradient(circle at 30% 30%, #fff 0, #fff 32%, #ffe4f0 33%) , linear-gradient(135deg,var(--pink-600),var(--rose-600));
      box-shadow: 0 18px 30px rgba(255,95,162,.4), inset 0 -6px 10px rgba(0,0,0,.08);
      letter-spacing: 1px; font-weight: 900; font-size: 18px;
    }
    .draw-btn .sparkle { position: absolute; inset: 0; pointer-events: none; }
    .sparkle i { position: absolute; font-style: normal; opacity: .85; animation: pop .8s ease forwards; }
    @keyframes pop { 0%{transform:scale(.2) translateY(0); opacity:0} 60%{opacity:1} 100%{transform:scale(1.3) translateY(-18px); opacity:0} }

    /* 结果卡片 */
    .result { display: none; text-align: center; margin-top: 10px; }
    .prize {
      display: inline-flex; align-items: center; gap: 10px; padding: 14px 18px;
      background: #fff; border: 2px dashed #ffc0d8; border-radius: 16px;
      box-shadow: 0 10px 20px rgba(255,143,177,.18);
      transform: translateZ(0);
    }
    .prize .icon { width: 34px; height: 34px; }
    .prize b { color: var(--rose-600); }
    .bonus {
      margin: 14px auto 0; max-width: 560px; line-height: 1.7; font-weight: 800; color: var(--pink-700);
    }

    /* 纸屑 */
    canvas#confetti { position: fixed; inset: 0; pointer-events: none; z-index: 2; }

    /* 工具类 */
    .hidden { display: none !important; }

    /* 降低动效（无障碍） */
    @media (prefers-reduced-motion: reduce) {
      .glow, .spin, .sparkle i { animation: none !important; }
    }
  </style>
</head>
<body>
  <div class="floaters" aria-hidden="true"></div>
  <canvas id="confetti"></canvas>

  <main class="wrap safe" role="main">
    <section class="card" aria-labelledby="title">
      <div id="entry" class="entry" role="region" aria-label="入口">
        <h1 class="title" id="title">给亲爱的的特别抽奖 💖</h1>
        <p class="subtitle">点击下方按钮进入粉白少女心的幸运现场～</p>
        <button id="go" class="btn" type="button" aria-describedby="title">点击这里领取特别抽奖机会</button>
      </div>

      <div id="lotto" class="lotto" role="region" aria-label="抽奖区域">
        <div class="title" style="margin-top:0">恭喜你亲爱的 🎀</div>
        <p class="headline">你获得 <b>特别抽奖机会</b>，可以赢取惊喜大奖！</p>

        <div class="wheel-wrap">
          <div id="wheel" class="glow" aria-hidden="true">
            <button id="drawBtn" class="draw-btn btn" type="button" aria-live="polite" aria-label="开始抽奖">
              <div>开 始<br/>抽 奖</div>
              <div class="sparkle" aria-hidden="true"></div>
            </button>
          </div>
        </div>

        <div id="result" class="result" role="status" aria-live="polite">
          <div class="prize">
            <span class="icon" id="prizeIcon"></span>
            <b id="prizeText"></b>
          </div>
          <div id="bonus" class="bonus">恭喜你亲爱的，你的运气太好了，额外赠送你一次抽奖机会！</div>
          <button id="confirm" class="btn muted" type="button">确认 ✓</button>
        </div>
      </div>
    </section>
  </main>

  <script>
    // ---------- 可爱背景元素（轻量） ----------
    (function makeFloaters(){
      const host = document.querySelector('.floaters');
      const vw = window.innerWidth, vh = window.innerHeight;
      const count = Math.min(28, Math.floor((vw*vh)/35000)); // 规模自适应
      for (let i=0;i<count;i++) {
        const el = document.createElement('div');
        el.className = 'floater ' + (Math.random() > 0.5 ? 'heart' : 'star');
        const size = 16 + Math.random() * 26;
        el.style.fontSize = size + 'px';
        el.style.left = (Math.random() * vw) + 'px';
        el.style.top  = (vh + Math.random() * vh) + 'px';
        el.style.animationDuration = (9 + Math.random() * 8) + 's';
        el.style.animationDelay = (-Math.random() * 12) + 's';
        host.appendChild(el);
      }
    })();

    // ---------- 状态节点 ----------
    const $ = (sel) => document.querySelector(sel);
    const entry = $('#entry');
    const lotto = $('#lotto');
    const goBtn = $('#go');
    const wheel = $('#wheel');
    const drawBtn = $('#drawBtn');
    const resultBox = $('#result');
    const prizeText = $('#prizeText');
    const prizeIcon = $('#prizeIcon');
    const bonus = $('#bonus');
    const confirmBtn = $('#confirm');

    // iOS 低功耗/后台恢复时，确保布局正常
    document.addEventListener('visibilitychange', () => {
      if (document.visibilityState === 'visible') resizeConfetti();
    }, {passive:true});

    // ---------- 入口到抽奖 ----------
    goBtn.addEventListener('click', () => {
      entry.style.display = 'none';
      lotto.style.display = 'block';
      drawBtn.focus({preventScroll:true});
    }, {passive:true});

    // ---------- 奖品（固定顺序） ----------
    const PRIZES = [
      { text: '52元红包',                         icon: redPacketIcon(), bonus: true },
      { text: '5次无条件生气劵（只能对小玉使用）',  icon: ticketIcon(),    bonus: true },
      { text: '可随意对小玉提3个任意要求',         icon: wishIcon(),      bonus: true },
      { text: '苹果 17 Pro Max',                  icon: phoneIcon(),     bonus: true },
      { text: '最终大奖：爱你一辈子的小玉',        icon: heartCrownIcon(),bonus: false },
    ];
    let step = 0;

    function sparkleBurst(){
      const box = drawBtn.querySelector('.sparkle');
      box.innerHTML = '';
      for (let i=0;i<12;i++) {
        const s = document.createElement('i');
        s.textContent = ['✦','❤','★','❀'][i%4];
        s.style.left = (20 + Math.random()*110) + 'px';
        s.style.top  = (20 + Math.random()*110) + 'px';
        s.style.animationDelay = (Math.random()*0.2) + 's';
        box.appendChild(s);
      }
    }

    // 防抖：避免快速重复点击
    let spinning = false;
    drawBtn.addEventListener('click', () => {
      if (spinning || step >= PRIZES.length) return;
      spinning = true;
      wheel.classList.remove('spin'); void wheel.offsetWidth; wheel.classList.add('spin');
      sparkleBurst();

      // 1.2s 后展示结果（与 CSS 动画一致）
      window.setTimeout(() => {
        const prize = PRIZES[step];
        prizeText.textContent = prize.text;
        prizeIcon.innerHTML = prize.icon;
        resultBox.style.display = 'block';
        bonus.style.display = prize.bonus ? 'block' : 'none';
        confirmBtn.textContent = prize.bonus ? '确认 ✓' : '开心收下 ❤';
        celebrate(120);
        spinning = false;
      }, 1200);
    }, {passive:true});

    confirmBtn.addEventListener('click', () => {
      step++;
      if (step < PRIZES.length) {
        // 返回继续抽
        resultBox.style.display = 'none';
        drawBtn.focus({preventScroll:true});
      } else {
        finalScreen();
      }
    }, {passive:true});

    function finalScreen(){
      const card = document.querySelector('.card');
      card.innerHTML = `
        <h1 class="title">恭喜你亲爱的 🎉</h1>
        <p class="headline" style="font-size:18px">全部奖品已收入怀中～</p>
        <div style="display:grid;place-items:center;gap:16px;margin:10px 0 20px">
          <div class="prize" style="font-size:18px">
            <span class="icon">${heartCrownIcon()}</span>
            <b>最终大奖：爱你一辈子的小玉</b>
          </div>
          <div style="color:var(--pink-700);font-weight:900">愿好运与爱意一直在线～ʕ•͡-•ʔ♡</div>
        </div>
        <div class="entry">
          <button class="btn" type="button" onclick="location.reload()">再来一次</button>
        </div>
      `;
      celebrate(180);
    }

    // ---------- 纸屑（高性能 rAF） ----------
    const confettiCanvas = document.getElementById('confetti');
    const ctx = confettiCanvas.getContext('2d', { alpha: true, desynchronized: true });
    const pieces = [];
    let rafId = 0;

    function resizeConfetti() {
      const dpr = Math.min(window.devicePixelRatio || 1, 2); // 限制 DPR，提升性能
      confettiCanvas.width = Math.floor(innerWidth  * dpr);
      confettiCanvas.height= Math.floor(innerHeight * dpr);
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0); // 逻辑像素绘制
    }
    window.addEventListener('resize', resizeConfetti, {passive:true});
    resizeConfetti();

    function celebrate(count = 100){
      for (let i=0;i<count;i++) {
        pieces.push({
          x: Math.random() * innerWidth,
          y: -20 - Math.random() * 40,
          w: 6 + Math.random() * 6,
          h: 10 + Math.random() * 10,
          r: Math.random() * Math.PI,
          s: 2 + Math.random() * 3,
          c: ['#ff5fa2','#ff8fb1','#ffd0e1','#ffc6e0','#fff0f6'][Math.floor(Math.random()*5)],
        });
      }
      if (!rafId) rafId = requestAnimationFrame(tick);
    }

    function tick(){
      ctx.clearRect(0, 0, innerWidth, innerHeight);
      for (let i=pieces.length-1; i>=0; i--) {
        const p = pieces[i];
        p.y += p.s;
        p.r += 0.03;
        p.x += Math.sin(p.y/30) * 0.6;

        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate(p.r);
        ctx.fillStyle = p.c;
        ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
        ctx.restore();

        if (p.y > innerHeight + 30) pieces.splice(i,1);
      }
      if (pieces.length > 0) {
        rafId = requestAnimationFrame(tick);
      } else {
        cancelAnimationFrame(rafId);
        rafId = 0;
      }
    }

    // ---------- SVG 图标 ----------
    function redPacketIcon(){
      return `
      <svg viewBox="0 0 64 64" width="34" height="34" aria-hidden="true">
        <defs>
          <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="#ff5fa2"/>
            <stop offset="100%" stop-color="#ff2f7d"/>
          </linearGradient>
        </defs>
        <rect x="8" y="10" rx="10" ry="10" width="48" height="44" fill="url(#g1)"/>
        <circle cx="32" cy="30" r="10" fill="#ffd36e"/>
        <path d="M22 22c4 5 16 5 20 0" stroke="#ffd36e" stroke-width="3" fill="none" stroke-linecap="round"/>
      </svg>`;
    }
    function ticketIcon(){
      return `
      <svg viewBox="0 0 64 64" width="34" height="34" aria-hidden="true">
        <rect x="8" y="18" width="48" height="28" rx="6" fill="#ffc6e0" stroke="#ff5fa2"/>
        <path d="M16 20v24M48 20v24" stroke="#ff5fa2" stroke-dasharray="4 4"/>
        <text x="32" y="36" text-anchor="middle" font-size="10" fill="#ff2f7d" font-weight="bold">TICKET</text>
      </svg>`;
    }
    function wishIcon(){
      return `
      <svg viewBox="0 0 64 64" width="34" height="34" aria-hidden="true">
        <circle cx="32" cy="32" r="22" fill="#ffe6f1" stroke="#ff5fa2"/>
        <path d="M20 34l8 8 16-16" fill="none" stroke="#ff5fa2" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>`;
    }
    function phoneIcon(){
      return `
      <svg viewBox="0 0 64 64" width="34" height="34" aria-hidden="true">
        <rect x="20" y="8" width="24" height="48" rx="6" fill="#ffe6f1" stroke="#ff5fa2"/>
        <rect x="24" y="14" width="16" height="32" rx="3" fill="#fff"/>
        <circle cx="32" cy="50" r="2" fill="#ff5fa2"/>
      </svg>`;
    }
    function heartCrownIcon(){
      return `
      <svg viewBox="0 0 64 64" width="34" height="34" aria-hidden="true">
        <path d="M32 50s-16-10-16-22a10 10 0 0 1 18-6 10 10 0 0 1 18 6c0 12-20 22-20 22z" fill="#ff8fb1" stroke="#ff5fa2"/>
        <path d="M20 20l4-6 8 4 8-4 4 6" fill="none" stroke="#ffbfcc" stroke-width="3" stroke-linecap="round"/>
      </svg>`;
    }
  </script>
</body>
</html>
